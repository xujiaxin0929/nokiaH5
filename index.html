<!DOCTYPE html>

<html lang="zh-CN">

<head>

    <meta charset="utf-8">

    <title>nokia demo</title>

    <!--<link rel="stylesheet" href="css/jquery.fullPage.css">-->
    <link rel="stylesheet" href="css/style.css">
    <script src="js/jquery-1.8.3.min.js"></script>
    <script src="js/jquery-ui-1.10.3.min.js"></script>
    <script src="js/jquery.fullPage.min.js"></script>
    <script type="text/javascript" src="https://res.wx.qq.com/open/js/jweixin-1.2.0.js"></script>
    <script>
        $(document).ready(function () {
            var myVideo = document.getElementById("audiofirst");
            var lastVideo = document.getElementById("audiolast");
            $('#fullpage').fullpage({

                // slidesColor: ['#1bbc9b', '#4BBFC3', '#7BAABE', '#f90'],

                anchors: ['page1', 'page2', 'page3', 'page4', 'page5', 'page6', 'page7'],
                'setAutoScrolling': true,
                onLeave: function (index, nextIndex) {
                    console.log(index, nextIndex)
                    // console.log(nextIndex)
                    if (index == 1) {
                        myVideo.pause();
                    }
                    //清除所有的current样式
                    $(".section").removeClass("current");

                    //添加样式
                    setTimeout(function () {
                        $(".section").eq(nextIndex - 1).addClass("current");
                    }, 30)


                },
                afterLoad: function (index) {
                    console.log(index);
                    if (index == 'page1' || index == 'page2') {
                        lastVideo.pause();

                    } else {
                        // lastVideo.play();
                        audioAutoPlay('audiolast')
                    }



                }
            });

            function loadAudio(src, callback) {
                var audio = new Audio(src);
                audio.onloadedmetadata = callback;
                audio.src = src;
            }

            var audioUrl = "vido.mp3";//音频路径
            var audioUrll = "vidoo.mp3";
            //调用方法
            loadAudio(audioUrll, function () {
                $('#audiolast').attr("src", audioUrll);
                alert("加载完成2");
            });
            loadAudio(audioUrl, function () {
                $('#audiofirst').attr("src", audioUrl);
                alert("加载完成1");
            });
            

            function play_music() {
                event.stopPropagation();
                audioAutoPlay('audiofirst');
                console.log(1)

            }
            $('#mc_play').on('click', function (e) {
                play_music();
            })
            // setInterval(function () {
            //     $.fn.fullpage.moveSectionDown();
            // }, 20000);
            function audioAutoPlay(id) {
                var audio = document.getElementById(id);
                audio.play();
                document.addEventListener("WeixinJSBridgeReady", function () {
                    audio.play();
                }, false);
                document.addEventListener('YixinJSBridgeReady', function () {
                    audio.play();
                }, false);
            }


        });
    </script>
</head>

<body>
    <div id="fullpage">
        <div class="section section_fitst current">
            <a href="javascript:;" id="mc_play" class="on">
            <img src="images/play.png" alt="">
           <audio controls preload='auto' id='audiofirst'>
                <source src="" type="audio/mp3"></source>
            </audio>
        </a>
        </div>

        <div class="section section_two ">
        </div>

        <div class="section section_three ">

        </div>

        <div class="section section_four ">
        </div>
        <div class="section section_five ">
        </div>
        <div class="section section_six ">
        </div>
        <div class="section section_last ">
        </div>
    </div>


    <audio controls loop="loop" preload='auto' id='audiolast'>
        <source src="" type="audio/mp3"></source>
    </audio>
</body>

</html>